<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>CourtagePro ‚Äî Admin</title>
  <link rel="stylesheet" href="/assets/styles.css"/>
</head>
<body>
  <div class="nav">
    <div class="nav-inner">
      <a class="brand" href="/">
        <span class="logo" aria-hidden="true"></span>
        <span>CourtagePro</span>
      </a>
      <div class="nav-links">
        <a class="" href="/">Accueil</a>
        <a class="" href="/devis">Demande de devis</a>
        <a class="" href="/client">Espace client</a>
        <a class="" href="/artisan">Espace artisan</a>
        <a class="active" href="/admin">Admin</a>
      </div>
      <div class="nav-cta">
        <a class="btn btn-ghost" href="/devis">Voir les projets</a>
        <a class="btn btn-primary" href="/devis">Demander un devis</a>
      </div>
    </div>
  </div>

  
<div class="container">
  <div class="split">
    <div class="card">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
        <div>
          <h2 class="section-title">Dashboard admin</h2>
          <p class="section-sub">Demandes r√©elles enregistr√©es via le formulaire + liste.</p>
        </div>
        <a class="btn btn-primary" href="/devis">Cr√©er une demande</a>
      </div>

      <div class="kpi-row" style="margin-top:14px">
        <div class="card kpi" style="box-shadow:none">
          <div><div class="t">Demandes</div><div class="n" id="kpiDem">‚Äî</div></div>
          <span class="badge">Total</span>
        </div>
        <div class="card kpi" style="box-shadow:none">
          <div><div class="t">Aujourd‚Äôhui</div><div class="n" id="kpiToday">‚Äî</div></div>
          <span class="badge ok">Actif</span>
        </div>
        <div class="card kpi" style="box-shadow:none">
          <div><div class="t">Statut</div><div class="n">V1</div></div>
          <span class="badge">Simple</span>
        </div>
      </div>

      <div style="margin-top:14px; overflow:auto">
        <table class="table" id="adminTable">
          <thead>
            <tr><th>Client</th><th>Travaux</th><th>Ville</th><th>Budget</th><th>Date</th></tr>
          </thead>
          <tbody>
            <tr><td colspan="5" class="notice">Chargement‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h3 style="margin:0">Actions (V2)</h3>
      <p class="section-sub">On ajoutera : validation artisans, matching, messagerie, paiement.</p>
      <div style="margin-top:12px; display:grid; gap:10px">
        <div class="card" style="box-shadow:none">
          <b>‚úî Validation artisans</b>
          <div class="notice">KYC, zones, m√©tiers, r√©putation</div>
        </div>
        <div class="card" style="box-shadow:none">
          <b>‚ö° Matching automatique</b>
          <div class="notice">m√©tier + zone + disponibilit√©</div>
        </div>
        <div class="card" style="box-shadow:none">
          <b>üí¨ Messagerie</b>
          <div class="notice">client ‚Üî artisan, fichiers, notifications</div>
        </div>
      </div>
      <img alt="Admin" style="width:100%; height:220px; border-radius:18px; border:1px solid var(--border); object-fit:cover; margin-top:12px"
        src="https://images.unsplash.com/photo-1556761175-4b46a572b786?auto=format&fit=crop&w=1600&q=70"/>
    </div>
  </div>
</div>

<script>
(async function(){
  try{
    const res = await fetch("/api/admin/demandes");
    const json = await res.json();
    const rows = json.demandes || [];
    const tbody = document.querySelector("#adminTable tbody");
    const today = new Date().toISOString().slice(0,10);
    const todayCount = rows.filter(r => (r.createdAt || "").slice(0,10) === today).length;

    document.getElementById("kpiDem").textContent = rows.length;
    document.getElementById("kpiToday").textContent = todayCount;

    if(!rows.length){
      tbody.innerHTML = '<tr><td colspan="5" class="notice">Aucune demande pour le moment.</td></tr>';
      return;
    }
    tbody.innerHTML = rows.map(r => `
      <tr>
        <td><b>${escapeHtml(r.nom||"")}</b><div class="notice">${escapeHtml(r.email||"")} ‚Ä¢ ${escapeHtml(r.telephone||"")}</div></td>
        <td>${escapeHtml(r.typeTravaux||"")}</td>
        <td>${escapeHtml(r.ville||"")}</td>
        <td>${escapeHtml(r.budget||"‚Äî")}</td>
        <td>${escapeHtml((r.createdAt||"").replace("T"," ").slice(0,16))}</td>
      </tr>
    `).join("");
  } catch(e){
    // ignore
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }
})();
</script>


  <div class="container footer">
    <div>¬© 2026 CourtagePro ‚Äî D√©mo premium (base √† am√©liorer).</div>
    <div class="notice">‚ö†Ô∏è Auth, paiement, matching avanc√©, messagerie : on les ajoute ensuite.</div>
  </div>

  <script src="/assets/app.js"></script>
</body>
</html>
